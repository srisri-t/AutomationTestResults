const fs=require("fs"),path=require("path");function sanitize(e){return e.replace(/\s+/g,"-").replace(/[^a-zA-Z0-9\-]/g,"").replace(/-+/g,"-").replace(/^-|-$/g,"").substring(0,60)}const reportsDir=process.cwd(),files=fs.readdirSync(reportsDir).filter(e=>e.endsWith(".json")&&"index.json"!==e&&!e.startsWith("generate-index")),index=[];files.forEach(e=>{const t=path.join(reportsDir,e);let s;try{s=JSON.parse(fs.readFileSync(t,"utf8"))}catch{return}let n="Automation Test Results",r="";if(Array.isArray(s)&&s[0]&&(s[0].name&&(n=s[0].name),s[0].metadata&&s[0].metadata.timestamp?r=s[0].metadata.timestamp:s[0].elements&&s[0].elements[0]&&s[0].elements[0].start_timestamp&&(r=s[0].elements[0].start_timestamp)),!r){const e=fs.statSync(t);r=e.mtime.toISOString()}const a=r.replace(/[:.]/g,"-"),i=sanitize(n)+"-"+a,o=i+".json";e!==o&&(fs.renameSync(t,path.join(reportsDir,o)),console.log(`Renamed ${e} -> ${o}`)),index.push({id:i,name:n,date:r})}),fs.writeFileSync(path.join(reportsDir,"index.json"),JSON.stringify(index,null,2)),console.log("index.json updated with",index.length,"reports.");